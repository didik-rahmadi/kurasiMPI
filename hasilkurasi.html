<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hasil Kurasi</title>
<link rel="stylesheet" href="styles.css">
</head>

<body>

<header>
  <div class="logo-group">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/Logo_of_Ministry_of_Education_and_Culture_of_Republic_of_Indonesia.svg/1200px-Logo_of_Ministry_of_Education_and_Culture_of_Republic_of_Indonesia.svg.png" id="logoHeader">
    <img src="https://trigger.id/wp-content/uploads/2025/05/pendidikan-1024x452.png">
    <img src="https://kemendikdasmen.go.id/kem_base/static/src/img/ramah.png">
    <img src="https://cdn-sdotid.adg.id/images/70b5e75c-f103-4e51-9b76-432a91d07494_980x382.png">
  </div>

  <h1>Kurasi Media Pembelajaran Interaktif Jilid 2</h1>
  <h1>Direktorat Sekolah Dasar</h1>
  <h2 class="sub-header-line">Direktorat Jenderal PAUD, Dikdas, dan Dikmen</h2>
  <h2 class="sub-header-line">Kementerian Pendidikan Dasar dan Menengah</h2>
  <div class="muted">Pilih kreator untuk melihat hasil kurasi.</div>

  <div class="controls">
    <select id="creator"></select>
    <button class="btn btn-primary" onclick="loadContents()">Lihat Hasil Kurasi</button>
    <button class="btn btn-secondary" onclick="location.href='index.html'">Kembali</button>
  </div>
</header>

<div id="contentList" class="card"></div>
<div id="detail" class="card"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbx__Yig33QCnywBPzOU-oD899gdjJL1OWoca7ajKIOsRpvbjx1NZZoDsBd3ZjC42pmi/exec";

function loadCreators(){
  fetch(API_URL+'?action=creators')
    .then(r=>r.json())
    .then(d=>{
      creator.innerHTML='<option value=""></option>';
      d.forEach(n=>creator.innerHTML+=`<option>${n}</option>`);
    });
}

function loadContents() {
  const creator = document.getElementById('creator').value;
  if (!creator) {
    alert('Silakan pilih kreator terlebih dahulu');
    return;
  }

  const listDiv = document.getElementById('contentList');
  const detailDiv = document.getElementById('detail');

  listDiv.innerHTML = 'Memuat hasil kurasi...';
  detailDiv.innerHTML = '';

  fetch(API_URL + '?action=hasil&kurator=' + encodeURIComponent(creator))
    .then(r => r.json())
    .then(data => {
      if (!data.rows || data.rows.length === 0) {
        listDiv.innerHTML = '<div class="muted">Belum ada hasil kurasi.</div>';
        return;
      }

      listDiv.innerHTML = data.rows.map((r, i) => `
        <div class="content-item" onclick="loadDetail(${i})">
          <b>${r[5]} | ${r[6]} | Fase ${r[4]}</b><br>
          <small>Kurator: ${r[1]}</small>
        </div>
      `).join('');

      // simpan cache global untuk detail
      window.__HASIL_CACHE__ = data;
    })
    .catch(err => {
      listDiv.innerHTML = '<div class="muted">Gagal memuat data</div>';
      console.error(err);
    });
}


function loadDetail(index) {
  const data = window.__HASIL_CACHE__;
  if (!data) return;

  const headers = data.headers;
  const row = data.rows[index];

  let html = `
    <div class="card">
      <p><b>Fase:</b> ${row[4]}</p>
      <p><b>Mapel:</b> ${row[5]}</p>
      <p><b>Judul:</b> ${row[6]}</p>
      <p><b>Pengembang:</b> ${row[3]}</p>
      <p><b>Kurator:</b> ${row[1]}</p>
      <hr>
  `;

  for (let i = 7; i < headers.length - 1; i += 2) {
    html += `
      <p><b>${headers[i]}</b></p>
      <div class="jawaban">
        <p>• ${row[i]}</p>
        <p>• ${row[i + 1]}</p>
      </div>
    `;
  }

  html += `<hr><p><b>Komentar:</b><br>${row[headers.length - 1]}</p></div>`;
  document.getElementById('detail').innerHTML = html;
}


loadCreators();
</script>
</body>
</html>
